# This script was written assuming that the RSAExploits directory
# is located in the same directory as this script

import RSAExploits.RSA_Cracker
from RSAExploits.rsa import rsaData
from RSAExploits.rsa import rsaObj
from RSAExploits.rsa import txt

# Parse and store all of the ciphertexts provided by the file
ciphertexts = []
c = None
e = None
N = None
f = open("common_moduli_test.txt", 'r')
for line in f:
    if line.startswith("ciphertext"):
        c = long(line.split(" ")[2], 0)
    elif line.startswith("e"):
        e = long(line.split(" ")[2])
    elif line.startswith("N"):
        N = long(line.split(" ")[2], 0)
        ciphertexts.append(rsaData(rsaObj(N, e), txt(c, idnum=1)))
f.close()

f = open("common_factor_test.txt", 'r')
for line in f:
    if line.startswith("ciphertext"):
        c = long(line.split(" ")[2], 0)
    elif line.startswith("e"):
        e = long(line.split(" ")[2])
    elif line.startswith("N"):
        N = long(line.split(" ")[2], 0)
        ciphertexts.append(rsaData(rsaObj(N, e), txt(c, idnum=None)))
f.close()

RSAExploits.RSA_Cracker.init()
RSAExploits.RSA_Cracker.attack(ciphertexts)
for ciphertext in ciphertexts:
    if ciphertext.getM() != None and ciphertext.getM() != 0x0:
        print hex(ciphertext.getM())[2:-1].decode("hex")
########################################################################
