# This script was written assuming that the RSAExploits directory
# is located in the same directory as this script

import RSAExploits.RSA_Cracker
from RSAExploits.RSA_Ciphertext import RSA_Ciphertext

# Parse and store all of the ciphertexts provided by the file
ciphertexts = []
c = None
e = None
N = None
f = open("common_moduli_test.txt", 'r')
for line in f:
    if line.startswith("ciphertext"):
        c = long(line.split(" ")[2], 0)
    elif line.startswith("e"):
        e = long(line.split(" ")[2])
    elif line.startswith("N"):
        N = long(line.split(" ")[2], 0)
        ciphertexts.append(RSA_Ciphertext(c, 1, N, e))
f.close()
RSAExploits.RSA_Cracker.init()
RSAExploits.RSA_Cracker.attack(ciphertexts)
for ciphertext in ciphertexts:
    if hasattr(ciphertext.text_data, "m"):
        print hex(ciphertext.text_data.m)[2:-1].decode("hex")
########################################################################
